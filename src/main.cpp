#include "Protocol.h"
#include "Package.h"
#include "zlib\easyzlib.h"

int main()
{
#ifdef TEST_ENCRYPTION
    char pPacketSample[] =
	{
		0xe8, 0x90, 0x02, 0x00, 0x6d, 0x3a, 0x1e, 0x00, 0x01, 0x3a, 0x1e, 0x00, 0x17, 0x3a, 0x02, 0x00,
        0x3a, 0x4e, 0x72, 0xcd, 0xb5, 0x8c, 0xa3, 0xc5, 0x48, 0x48, 0x1e, 0xd9, 0xe1, 0xc9, 0x37, 0x33,
        0xf3, 0x0c, 0x8e, 0x02, 0xb9, 0x96, 0x3f, 0x6b, 0x7b, 0x77, 0x4b, 0x72, 0x72, 0x6b, 0x15, 0xb2,
        0x0a, 0x14, 0x17, 0xe9, 0xf6, 0x76, 0x31, 0x19, 0x64, 0xaf, 0x59, 0xad, 0x9d, 0x3e, 0xfe, 0xf4,
        0x34, 0x02, 0xe4, 0xce, 0x7f, 0xd1, 0xe3, 0x8f, 0x32, 0x37, 0x67, 0xf3, 0x40, 0x7d, 0x2b, 0x2b,
        0x0a, 0x34, 0x14, 0x51, 0x79, 0x58, 0x7e, 0x4b, 0x1a, 0x14, 0x86, 0x30, 0x72, 0x7d, 0x01, 0x65,
        0x7c, 0x09, 0xbf, 0x63, 0xd9, 0x76, 0x11, 0x9f, 0x7b, 0xd4, 0x38, 0x00
	};

    int nSampleLen = 108;

    CProtocol pCommProto, *pUnkProto;
    unsigned short b16Unused = 0;
    char b8Unused = 0;
    int b32Unused = 0, nRet;
    CPackage m_pack = CPackage(pPacketSample, nSampleLen, 28, 58);

    nRet = pCommProto.Read(m_pack, pUnkProto, b16Unused, b8Unused, b32Unused);

    if(nRet == 1)
        printf("DECRYPTED SUCCESSFULLY!\n");
    else
        printf("ERROR #%d DESCRIPTION: %d!\n", nRet, b32Unused);
#endif // TEST_ENCRYPTION

#ifdef TEST_COMPRESSION
    unsigned char pPacketSample_[] =
	{
		0x78, 0xDA, 0x63, 0x63, 0x62, 0x80, 0x82, 0x07, 0x40, 0x2C, 0x02, 0xC4, 0x2E, 0xC6, 0xE6, 0x49,
        0x89, 0x86, 0x46, 0x69, 0x89, 0xA6, 0x16, 0xA6, 0x96, 0xE6, 0x46, 0x46, 0x16, 0xC6, 0x26, 0x16,
        0x5C, 0x40, 0x71, 0x43, 0x63, 0x23, 0x0B, 0x33, 0x13, 0x23, 0x73, 0x63, 0xF3, 0x59, 0x06, 0x0C,
        0x70, 0x50, 0x1A, 0x62, 0xC8, 0x08, 0xA2, 0x01, 0x66, 0xED, 0x09, 0xBF
	};
	
    int nSampleLen_ = 60;
    unsigned char pBuf[72];
    int nBufLen = 72, nRetLen;

    int nRet = ezuncompress(pBuf, &nRetLen,  pPacketSample_, nSampleLen_);
	
    printf("ezuncompress returned %d\n", nRet);
    printf("Decompressed length is %d\n", nRetLen);
    printf("Decompressed length should be %d\n", 72);

#ifdef DUMP_DATA
    //FILE *m_file = fopen("dump_de.txt", "wb");
    //fwrite(pBuf, nBufLen, 1, m_file);
    //fclose(m_file);
#endif // DUMP_DATA
#endif // TEST_COMPRESSION

    return 0;
}
